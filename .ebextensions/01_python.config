# AWS Elastic Beanstalk Deployment Configuration
# File: .ebextensions/01_python.config

option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: application.py
  aws:elasticbeanstalk:application:environment:
    PYTHONPATH: "/var/app/current:$PYTHONPATH"
    FLASK_ENV: "production"
    DATABASE_URL: "sqlite:///reproductive_analysis.db"
  aws:autoscaling:launchconfiguration:
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
    InstanceType: t3.medium
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 10
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced

files:
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/01-nginx-access.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/log/nginx/access.log

commands:
  01_install_dependencies:
    command: "pip install -r requirements.txt"
  02_create_upload_dir:
    command: "mkdir -p /var/app/current/uploads"
  03_set_permissions:
    command: "chmod 755 /var/app/current/uploads"
